<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BastaDental - Dentist Dashboard</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="css/dentist.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <!-- Add notification system first -->
    <script src="js/notifications.js"></script>
    <!-- Add auth.js before main script to protect the page -->
    <script src="js/auth.js"></script>
    <script>
      // Immediately redirect if not authenticated - runs before page loads
      if (!localStorage.getItem('user')) {
        window.location.replace('login.html')
      } else {
        // Check if user is dentist or admin, redirect if not
        try {
          const user = JSON.parse(localStorage.getItem('user'))
          if (user.role !== 'dentist' && user.role !== 'admin') {
            // We'll handle the notification in DOMContentLoaded event
            window.location.replace('dashboard.html')
          }
        } catch (e) {
          localStorage.removeItem('user')
          window.location.replace('login.html')
        }
      }
    </script>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <div class="container">
        <div class="logo">BastaDental Dentist</div>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="#" class="active">Dentist Dashboard</a></li>
          <li><a href="#" id="logout-btn">Logout</a></li>
        </ul>
        <div class="burger">
          <div class="line1"></div>
          <div class="line2"></div>
          <div class="line3"></div>
        </div>
      </div>
    </nav>

    <!-- Dentist Dashboard Content -->
    <section class="dentist-dashboard">
      <div class="container">
        <div class="dashboard-header">
          <h1>Welcome, Dr. <span id="dentist-name">Name</span>!</h1>
          <p>Manage your appointments and patient information</p>
        </div>

        <!-- Tabs Navigation -->
        <div class="dentist-tabs">
          <button class="tab-btn active" data-tab="appointments">
            <i class="fas fa-calendar-alt"></i> Appointments
          </button>
          <button class="tab-btn" data-tab="availability">
            <i class="fas fa-clock"></i> Availability
          </button>
          <button class="tab-btn" data-tab="profile">
            <i class="fas fa-user-md"></i> Profile
          </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Appointments Tab -->
          <div class="tab-pane active" id="appointments-tab">
            <div class="tab-header">
              <h2>Upcoming Appointments</h2>
              <div class="filters">
                <select id="status-filter">
                  <option value="all">All Status</option>
                  <option value="pending">Pending</option>
                  <option value="confirmed">Confirmed</option>
                  <option value="completed">Completed</option>
                  <option value="cancelled">Cancelled</option>
                </select>
                <input
                  type="date"
                  id="date-filter"
                  placeholder="Filter by date"
                />
                <button id="clear-filters" class="btn btn-sm">Clear</button>
                <button id="view-toggle" class="btn btn-sm btn-primary">
                  View All Appointments
                </button>
              </div>
            </div>
            <div id="view-mode-indicator" class="view-mode">
              Viewing: My Appointments
            </div>
            <div class="appointments-list">
              <table id="dentist-appointments-table">
                <thead>
                  <tr>
                    <th>Date & Time</th>
                    <th>Patient</th>
                    <th>Service</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="appointments-data">
                  <!-- Appointments will be loaded dynamically -->
                </tbody>
              </table>
              <div id="no-appointments" class="no-data-message">
                No appointments found.
              </div>
            </div>
          </div>

          <!-- Availability Tab -->
          <div class="tab-pane" id="availability-tab">
            <div class="tab-header">
              <h2>Manage Your Availability</h2>
              <p class="availability-info">
                <i class="fas fa-info-circle"></i> Your working hours are
                automatically set to Monday-Friday, 9:00 AM - 5:00 PM. Use the
                forms below to mark days or periods when you're unavailable.
              </p>
            </div>
            <div class="availability-container">
              <div class="availability-form">
                <!-- Removed "Set Working Hours" section -->

                <!-- New section for permanent unavailable days -->
                <h3>Set Permanently Unavailable Days</h3>
                <form id="permanent-unavailability-form">
                  <div class="form-group">
                    <label>Select days you're never available:</label>
                    <div class="weekday-selector">
                      <label class="weekday-checkbox">
                        <input
                          type="checkbox"
                          value="0"
                          name="permanent-unavailable"
                        />
                        Sunday
                      </label>
                      <label class="weekday-checkbox">
                        <input
                          type="checkbox"
                          value="1"
                          name="permanent-unavailable"
                        />
                        Monday
                      </label>
                      <label class="weekday-checkbox">
                        <input
                          type="checkbox"
                          value="2"
                          name="permanent-unavailable"
                        />
                        Tuesday
                      </label>
                      <label class="weekday-checkbox">
                        <input
                          type="checkbox"
                          value="3"
                          name="permanent-unavailable"
                        />
                        Wednesday
                      </label>
                      <label class="weekday-checkbox">
                        <input
                          type="checkbox"
                          value="4"
                          name="permanent-unavailable"
                        />
                        Thursday
                      </label>
                      <label class="weekday-checkbox">
                        <input
                          type="checkbox"
                          value="5"
                          name="permanent-unavailable"
                        />
                        Friday
                      </label>
                      <label class="weekday-checkbox">
                        <input
                          type="checkbox"
                          value="6"
                          name="permanent-unavailable"
                        />
                        Saturday
                      </label>
                    </div>
                  </div>
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Unavailable Days
                  </button>
                  <div
                    id="permanent-unavailability-status"
                    class="form-status"
                  ></div>
                </form>

                <!-- New section for temporary unavailable days -->
                <h3>Set Temporarily Unavailable Days</h3>
                <form id="temporary-unavailability-form">
                  <div class="form-group">
                    <label for="unavailable-date-start">From Date</label>
                    <input type="date" id="unavailable-date-start" required />
                  </div>
                  <div class="form-group">
                    <label for="unavailable-date-end">To Date (Optional)</label>
                    <input type="date" id="unavailable-date-end" />
                  </div>
                  <div class="form-group">
                    <label for="unavailability-reason">Reason (Optional)</label>
                    <input
                      type="text"
                      id="unavailability-reason"
                      placeholder="e.g., Vacation, Conference"
                    />
                  </div>
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-calendar-times"></i> Mark as Unavailable
                  </button>
                  <div
                    id="temporary-unavailability-status"
                    class="form-status"
                  ></div>
                </form>
              </div>
              <div class="availability-list">
                <h3>Unavailable Days</h3>
                <div id="unavailable-days-container">
                  <div class="unavailability-section">
                    <h4>Permanently Unavailable</h4>
                    <div id="permanent-unavailability-list">
                      <!-- Permanent unavailability will be loaded dynamically -->
                    </div>
                  </div>
                  <div class="unavailability-section">
                    <h4>Temporarily Unavailable</h4>
                    <div id="temporary-unavailability-list">
                      <!-- Temporary unavailability will be loaded dynamically -->
                    </div>
                    <div id="no-unavailability" class="no-data-message">
                      No unavailable days set.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Profile Tab -->
          <div class="tab-pane" id="profile-tab">
            <div class="tab-header">
              <h2>Your Dentist Profile</h2>
            </div>
            <div class="profile-container">
              <div class="profile-form">
                <h3>Professional Information</h3>
                <form id="dentist-profile-form">
                  <div class="form-group">
                    <label for="specialization">Specialization</label>
                    <input
                      type="text"
                      id="specialization"
                      placeholder="e.g., Orthodontics, Pediatric Dentistry"
                    />
                  </div>
                  <div class="form-group">
                    <label for="bio">Professional Bio</label>
                    <textarea
                      id="bio"
                      rows="5"
                      placeholder="Tell patients about your experience and expertise"
                    ></textarea>
                  </div>
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Update Profile
                  </button>
                  <div id="profile-status" class="form-status"></div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Appointment Detail Modal -->
    <div id="appointment-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Appointment Details</h2>
        <div id="appointment-details">
          <!-- Details will be loaded dynamically -->
        </div>
        <div class="patient-notes-section">
          <h3>Patient Notes</h3>
          <textarea
            id="patient-notes"
            rows="4"
            placeholder="Add notes about this patient or appointment"
          ></textarea>
        </div>
        <div class="modal-actions">
          <button id="confirm-appointment" class="btn btn-success">
            <i class="fas fa-check"></i> Confirm
          </button>
          <button id="complete-appointment" class="btn btn-primary">
            <i class="fas fa-check-double"></i> Complete
          </button>
          <button id="cancel-appointment" class="btn btn-danger">
            <i class="fas fa-times"></i> Cancel
          </button>
          <button id="save-notes" class="btn btn-info">
            <i class="fas fa-save"></i> Save Notes
          </button>
          <button id="close-modal" class="btn btn-secondary">Close</button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <div class="container">
        <p>&copy; 2025 BastaDental. All rights reserved.</p>
      </div>
    </footer>

    <!-- Scripts -->
    <script>
      // Double-check authentication when DOM is fully loaded
      document.addEventListener('DOMContentLoaded', function () {
        // Check if user is dentist or admin, redirect if not
        try {
          const user = JSON.parse(localStorage.getItem('user'))
          if (!user || (user.role !== 'dentist' && user.role !== 'admin')) {
            showNotificationDialog(
              'Access denied. Dental professional access only.',
              'Access Denied',
              () => window.location.replace('dashboard.html')
            )
            return
          }
        } catch (e) {
          localStorage.removeItem('user')
          window.location.replace('login.html')
          return
        }
      })
    </script>
    <script src="js/dentist.js"></script>
    <script src="js/dentist-auth.js"></script>
  </body>
</html>
